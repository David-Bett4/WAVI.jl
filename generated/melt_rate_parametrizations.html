<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Melt rate parametrizations · WAVI.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.png" alt="WAVI.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">WAVI.jl</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><a class="tocitem" href="../installation_instructions.html">Installation instructions</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="planar_one_dimensional_flow.html">One-dimensional planar flow</a></li><li><a class="tocitem" href="bumpy_bed.html">Flow over a bumpy bed</a></li><li><a class="tocitem" href="overdeepened_bed.html">Two-dimensional flow with overdeepened bed</a></li><li class="is-active"><a class="tocitem" href="melt_rate_parametrizations.html">Melt rate parametrizations</a><ul class="internal"><li><a class="tocitem" href="#Install-dependencies"><span>Install dependencies</span></a></li><li><a class="tocitem" href="#Set-up-grid"><span>Set up grid</span></a></li><li><a class="tocitem" href="#Getting-the-ice-thickness"><span>Getting the ice thickness</span></a></li><li><a class="tocitem" href="#Melt-Rate-Models"><span>Melt Rate Models</span></a></li><li><a class="tocitem" href="#Visualizing"><span>Visualizing</span></a></li><li><a class="tocitem" href="#Defining-A-New-Melt-Rate-Model"><span>Defining A New Melt Rate Model</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../physics/overview.html">Overview</a></li><li><a class="tocitem" href="../physics/governing_equations.html">Governing Equations</a></li><li><a class="tocitem" href="../physics/melting.html">Melt Rates</a></li><li><a class="tocitem" href="../physics/calving.html">Calving</a></li><li><a class="tocitem" href="../physics/damage.html">Damage</a></li></ul></li><li><a class="tocitem" href="../numerical_procedure/numerical_procedure.html">Numerical Implementation</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">WAVI Setup</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../data_structure/overview.html">Overview</a></li><li><a class="tocitem" href="../data_structure/simulations.html">Simulations</a></li><li><a class="tocitem" href="../data_structure/model.html">Models</a></li><li><a class="tocitem" href="../data_structure/timestepping_params.html">Timestepping Parameters</a></li><li><a class="tocitem" href="../data_structure/output_writing.html">Output Writing</a></li><li><a class="tocitem" href="../data_structure/grid.html">Grid</a></li><li><a class="tocitem" href="../data_structure/solver_parameters.html">Solver Parameters</a></li><li><a class="tocitem" href="../data_structure/params.html">Physical Paramters</a></li><li><a class="tocitem" href="../data_structure/initial_conditions.html">Initial Conditions</a></li><li><a class="tocitem" href="../data_structure/fields.html">Fields</a></li><li><a class="tocitem" href="../data_structure/melt_rate_models.html">Melt Rate Models</a></li></ul></li><li><a class="tocitem" href="../simulation_tips.html">Simulation tips</a></li><li><a class="tocitem" href="../mitgcm_coupling.html">MITgcm coupling</a></li><li><a class="tocitem" href="../contributing.html">Contributor&#39;s guide</a></li><li><a class="tocitem" href="../references.html">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="melt_rate_parametrizations.html">Melt rate parametrizations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="melt_rate_parametrizations.html">Melt rate parametrizations</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Melt-rates"><a class="docs-heading-anchor" href="#Melt-rates">Melt rates</a><a id="Melt-rates-1"></a><a class="docs-heading-anchor-permalink" href="#Melt-rates" title="Permalink"></a></h1><p>This example demonstrates the wealth of melt rate parametrizations that are included in WAVI.jl. We produce a picture of the melt rate for the MISMIP+ steady state geometry for each of the melt rate specifications included in WAVI.jl. These are:</p><ul><li>Quadratic melt rates</li><li>A plume melt emulator</li><li>PICO melt rate model</li><li>Binary file melt rate</li></ul><p>You can find more info on each of these models in the Physics tab.</p><p>We also demonstrate how to add a simple melt rate model to WAVI.jl.</p><h2 id="Install-dependencies"><a class="docs-heading-anchor" href="#Install-dependencies">Install dependencies</a><a id="Install-dependencies-1"></a><a class="docs-heading-anchor-permalink" href="#Install-dependencies" title="Permalink"></a></h2><p>First let&#39;s make sure we have all required packages installed.</p><pre><code class="language-julia hljs">using Pkg
pkg&quot;add WAVI, Plots&quot;</code></pre><pre><code class="language-julia hljs">using WAVI, Plots, Downloads</code></pre><h2 id="Set-up-grid"><a class="docs-heading-anchor" href="#Set-up-grid">Set up grid</a><a id="Set-up-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-grid" title="Permalink"></a></h2><p>First we&#39;ll make the grid, which has 2km resolution, with 320 grid points in the x-direction and 40 grid points in the y-direction.</p><pre><code class="language-julia hljs">nx = 320;
ny = 40;
grid = Grid(nx=nx,
            ny=ny,
            dx=2000.,
            dy=2000.);</code></pre><p>We&#39;ll cheat and use the MISMIP+ bed, which is hard coded into WAVI.jl (see the overdeepened bed example to see how to do this properly)</p><pre><code class="language-julia hljs">bed = WAVI.mismip_plus_bed # function definition</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">mismip_plus_bed (generic function with 1 method)</code></pre><h2 id="Getting-the-ice-thickness"><a class="docs-heading-anchor" href="#Getting-the-ice-thickness">Getting the ice thickness</a><a id="Getting-the-ice-thickness-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-the-ice-thickness" title="Permalink"></a></h2><p>To save time, we&#39;re going to pull the steady state ice thickness from online, where it is stored as a binary file. (this ice thickness is the result of the overdeepened bed example with 2km resolution).</p><pre><code class="language-julia hljs">fname = Downloads.download(&quot;https://github.com/alextbradley/MISMIP_data/raw/main/WAVI_ice0_2km_thick.bin&quot;);
h = Array{Float64,2}(undef, nx, ny);
read!(fname, h)
h = ntoh.(h)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">320×40 Matrix{Float64}:
 1240.71    1240.52    1240.79   1243.04   …  1240.79   1240.52    1240.71
 1239.43    1239.46    1239.92   1242.28      1239.92   1239.46    1239.43
 1238.0     1238.09    1238.66   1241.12      1238.66   1238.09    1238.0
 1236.43    1236.57    1237.2    1239.73      1237.2    1236.57    1236.43
 1234.79    1234.96    1235.63   1238.22      1235.63   1234.96    1234.79
 1233.09    1233.27    1233.99   1236.61   …  1233.99   1233.27    1233.09
 1231.35    1231.55    1232.29   1234.95      1232.29   1231.55    1231.35
 1229.58    1229.79    1230.55   1233.25      1230.55   1229.79    1229.58
 1227.79    1228.01    1228.79   1231.52      1228.79   1228.01    1227.79
 1225.98    1226.21    1227.02   1229.77      1227.02   1226.21    1225.98
    ⋮                                      ⋱                       
   91.1786    99.6397   125.718   159.41       120.796    97.2593    90.9562
   91.1545    99.6271   126.341   159.755      119.843    96.328     90.5038
   93.4665   102.735    129.345   160.667      122.129    97.9639    91.6603
   93.7888   103.096    129.765   160.604      121.461    97.6345    91.6288
   95.8098   105.955    132.509   161.371  …   124.501   100.049     93.4872
   96.3383   106.644    132.848   160.894      123.95    100.085     93.487
   97.6911   108.25     134.514   161.808      126.001   102.196     95.2686
   98.1116   108.84     134.777   161.338      125.575   102.24      95.1453
   98.9331   109.265    135.555   162.677      126.237   103.693     96.3654</code></pre><p>The final line converts the endianness from big-endian to little-endian. Lets make an InitialConditions object to store this ice thickness.</p><pre><code class="language-julia hljs">initial_conditions = InitialConditions(initial_thickness = h)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">InitialConditions{Float64}
  initial_thickness: Array{Float64}((320, 40)) [1240.7147043963084 1240.5176518946532 … 1240.5176480776076 1240.7147005602642; 1239.430357547246 1239.456525768309 … 1239.456521808805 1239.43035368584; … ; 98.11156367038602 108.8403424773417 … 102.24041066038936 95.14529176471977; 98.93314542442948 109.26541202479837 … 103.69262270922071 96.36540360906]
  initial_viscosity: Array{Float64}((1, 1, 1)) [NaN]
  initial_temperature: Array{Float64}((1, 1, 1)) [NaN]
  initial_damage: Array{Float64}((1, 1, 1)) [NaN]
</code></pre><h2 id="Melt-Rate-Models"><a class="docs-heading-anchor" href="#Melt-Rate-Models">Melt Rate Models</a><a id="Melt-Rate-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Melt-Rate-Models" title="Permalink"></a></h2><p>We&#39;ll loop over the melt rate models, producing a map of the melt rate in the MISMIP+ geometry each time. First let&#39;s make the melt rate models in turn, starting with quadratic. The parameter <span>$\gamma_T$</span> is a normalization cofficient, chosen so that the mean melt rate on the shelf is approx 10m/a.</p><pre><code class="language-julia hljs">melt_quad = QuadraticMeltRate(γT = 0.745*1e-3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">QuadraticMeltRate{Float64}(0.000745, -0.0573, 0.000832, 0.000761, 918.8, 1028.0, 335000.0, 3974.0, WAVI.isomip_warm0_temp, WAVI.isomip_warm0_salinity, true, false)</code></pre><p>Next up: PICO. For this parametrization, we have to pass a mask defining where the ice front is:</p><pre><code class="language-julia hljs">ice_front_mask = zeros(nx,ny);
ice_front_mask[end,:] .= 1;
melt_PICO = PICO(ice_front_mask = ice_front_mask,
                    T0 = 1.2,
                    S0 = 34.6,
                    γT = 0.87e-5,
                    nbox = 5);</code></pre><p>Again, <span>$\gamma_T$</span> is a normalization coefficient. See the PICO page for a descritpion of the other parameters listed here.</p><p>Now: plume model emulator:</p><pre><code class="language-julia hljs">melt_PME = PlumeEmulator(α=1.49)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PlumeEmulator{Float64}(1.49, -0.0573, 0.000832, 0.000761, 0.036, 0.0025, 0.0118, 335000.0, 3974.0, 0.000786, 3.87e-5, 9.81, 918.0, 1028.0, WAVI.isomip_warm0_temp, WAVI.isomip_warm0_salinity)</code></pre><p>In this case, the normalization coefficent is named <span>$\alpha$</span>, and has a slightly different meaning.</p><p>Finally, a binary file, in which the melt rate is read in from a file. First, we&#39;ll create such a file, which will set the melt rate to be unifrom on the shelf.</p><pre><code class="language-julia hljs">isfloat = (h .&lt; -918.0/1028.0 .* bed.(grid.xxh, grid.yyh)) #indices of floating elements
m = zeros(nx,ny)
m[isfloat] .= 10.0 #set everywhere floating to 10m/a
folder = joinpath(@__DIR__, &quot;melt_rate_parametrizations&quot;);
isdir(folder) &amp;&amp; rm(folder, force = true, recursive = true);
mkdir(folder) ;
out = open(joinpath(folder,&quot;melt.bin&quot;), &quot;w&quot;)
write(out, m)
close(out)</code></pre><p>Now we can point our binary file melt rate here</p><pre><code class="language-julia hljs">binfile_melt = BinfileMeltRate(input_filename = joinpath(folder,&quot;melt.bin&quot;))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BinfileMeltRate(&quot;C:\\Users\\aleey\\.julia\\dev\\WAVI.jl\\docs\\build\\generated\\melt_rate_parametrizations\\melt.bin&quot;)</code></pre><p>Let&#39;s put these into a dictionary:</p><pre><code class="language-julia hljs">melt_rates = Dict(&quot;Quadratic&quot; =&gt; melt_quad, &quot;PME&quot; =&gt; melt_PME, &quot;PICO&quot; =&gt; melt_PICO, &quot;Binary file&quot; =&gt; binfile_melt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{String, WAVI.AbstractMeltRate} with 4 entries:
  &quot;Quadratic&quot;   =&gt; QuadraticMeltRate{Float64}(0.000745, -0.0573, 0.000832, 0.00…
  &quot;PICO&quot;        =&gt; PICO{Float64, Int64}(8.7e-6, -0.0573, 0.000832, 0.000761, 33…
  &quot;PME&quot;         =&gt; PlumeEmulator{Float64}(1.49, -0.0573, 0.000832, 0.000761, 0.…
  &quot;Binary file&quot; =&gt; BinfileMeltRate(&quot;C:\\Users\\aleey\\.julia\\dev\\WAVI.jl\\doc…</code></pre><h2 id="Visualizing"><a class="docs-heading-anchor" href="#Visualizing">Visualizing</a><a id="Visualizing-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing" title="Permalink"></a></h2><p>We&#39;ll loop over the melt rate specifiers. Each time, we make a model with the appropriate melt rate specifier using the &#39;melt_rate&#39; keyword.  We update it to bring the melt in line and plot the results. We set the number of Picard iterations to 1 (we don&#39;t care about the velocity being accurate!)</p><pre><code class="language-julia hljs">for (key, melt) in melt_rates
    model = Model(grid = grid,
            bed_elevation = bed,
            initial_conditions = initial_conditions,
            solver_params = SolverParams(maxiter_picard=1),
            melt_rate = melt);

    update_state!(model);
    m = deepcopy(model.fields.gh.basal_melt)
    m[model.fields.gh.grounded_fraction .== 1.] .= NaN
    msat = deepcopy(m)
    msat[msat .&gt; 50] .= 50

    plt = Plots.heatmap(model.grid.xxh[:,1]/1e3, model.grid.yyh[1,:]/1e3, msat&#39;,
                        xlabel = &quot;x (km)&quot;,
                        ylabel = &quot;y (km)&quot;,
                        colorbar_title = &quot;melt rate (m/yr)&quot;,
                        title = key,
                        framestyle = &quot;box&quot;)
    xlims!((420, 640))
    plot!(size = (500,300))
    display(plt)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Assignment to `m` in soft scope is ambiguous because a global variable by the same name exists: `m` will be treated as a new local. Disambiguate by using `local m` to suppress this warning or `global m` to assign to the existing global variable.
└ @ melt_rate_parametrizations.md:137</code></pre><h2 id="Defining-A-New-Melt-Rate-Model"><a class="docs-heading-anchor" href="#Defining-A-New-Melt-Rate-Model">Defining A New Melt Rate Model</a><a id="Defining-A-New-Melt-Rate-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-A-New-Melt-Rate-Model" title="Permalink"></a></h2><p>In this section, we show how to specify a new melt rate model, which takes the melt rate according to the MISMIP+ experiment: melt rate on floating cells in <span>$0.2 \tanh((z_d - z_b)/75) \max(-100 - z_d,0)$</span> where <span>$z_d$</span> is the ice shelf draft and <span>$z_d - z_b$</span> is the cavity thickness. There are three steps. First, we define a structure which stores parameters:</p><pre><code class="language- hljs">struct MISMIPMeltRateOne{T &lt;: Real} &lt;: AbstractMeltRate
    α  :: T
    ρi :: T
    ρw :: T
end</code></pre><p>In this case, a normalization coefficient <span>$\alpha$</span>, and the denisities of ice and ocean, <span>$\rho_i$</span> and <span>$\rho_w$</span>, respectively.</p><p>Now we define a constructor, a function that defines how to create one of these structures</p><pre><code class="language-julia hljs">MISMIPMeltRateOne(; α = 1.0, ρi = 918.0, ρw = 1028.0) = MISMIPMeltRateOne(α,ρi, ρw)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MISMIPMeltRateOne (generic function with 1 method)</code></pre><p>The final step is to define a function &quot;update<em>melt</em>rate!(melt_rate::TYPE, fields, grid)&quot; which tells WAVI how to update the melt rate in this example. here, TYPE is the name of the structure we just made. Note that the arguments of this function must be as mentioned here, so that the multiple dispatch capability can be leveraged!</p><pre><code class="language- hljs">function update_melt_rate!(melt_rate::WAVI.MISMIPMeltRateOne, fields, grid)
    @unpack basal_melt, h, b  = fields.gh
    draft = -(melt_rate.ρi / melt_rate.ρw) .* h
    cavity_thickness = draft .- b
    cavity_thickness = max.(cavity_thickness, 0)
    m =  melt_rate.α .* 0.2*tanh.(cavity_thickness./75).*max.((-100 .- draft), 0)
    basal_melt[:] .= m[:]
end</code></pre><p>Now we can plot the melt rate with this model:</p><pre><code class="language- hljs">model = Model(grid = grid,
            bed_elevation = bed,
            initial_conditions = initial_conditions,
            solver_params = SolverParams(maxiter_picard=1),
            melt_rate = MISMIPMeltRateOne());

update_state!(model);
m = deepcopy(model.fields.gh.basal_melt)
m[model.fields.gh.grounded_fraction .== 1.] .= NaN
msat = deepcopy(m)
msat[msat .&gt; 50] .= 50

plt = Plots.heatmap(model.grid.xxh[:,1]/1e3, model.grid.yyh[1,:]/1e3, msat&#39;,
            xlabel = &quot;x (km)&quot;,
            ylabel = &quot;y (km)&quot;,
            colorbar_title = &quot;melt rate (m/yr)&quot;,
            title = key,
            framestyle = &quot;box&quot;)
xlims!((420, 640))
plot!(size = (500,300))
display(plt)</code></pre><p>Finally, let&#39;s clean up the files we just made</p><pre><code class="language-julia hljs">rm(folder, force = true, recursive = true);</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="overdeepened_bed.html">« Two-dimensional flow with overdeepened bed</a><a class="docs-footer-nextpage" href="../physics/overview.html">Overview »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Monday 8 November 2021 20:41">Monday 8 November 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
